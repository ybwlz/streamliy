# risk.py ä»£ç å®Œå…¨è§£æ

## ğŸ“‹ ä»£ç ç»“æ„æ€»è§ˆï¼ˆ785è¡Œï¼‰

è¿™ä¸ªæ–‡ä»¶åˆ†ä¸º**5ä¸ªä¸»è¦éƒ¨åˆ†**ï¼š

```
1. å¯¼å…¥åº“å’Œé…ç½®ï¼ˆ1-31è¡Œï¼‰
2. æ•°æ®åŠ è½½å’Œé¢„å¤„ç†ï¼ˆ33-102è¡Œï¼‰
3. é£é™©æŒ‡æ ‡è®¡ç®—ï¼ˆ104-401è¡Œï¼‰â­ æ ¸å¿ƒéƒ¨åˆ†
4. å›¾è¡¨ç»˜åˆ¶ï¼ˆ403-636è¡Œï¼‰
5. ä¸»ç¨‹åºç•Œé¢ï¼ˆ638-785è¡Œï¼‰
```

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šå¯¼å…¥åº“å’Œé…ç½®ï¼ˆ1-31è¡Œï¼‰

### 1.1 å¯¼å…¥åº“ï¼ˆ1-7è¡Œï¼‰
```python
import pandas as pd      # æ•°æ®å¤„ç†
import numpy as np       # æ•°å€¼è®¡ç®—
import plotly.graph_objects as go  # ç»˜å›¾
from plotly.subplots import make_subplots  # å­å›¾
import streamlit as st   # Webç•Œé¢æ¡†æ¶
import warnings
warnings.filterwarnings('ignore')  # å¿½ç•¥è­¦å‘Š
```

**ä½œç”¨**ï¼šå¼•å…¥éœ€è¦çš„å·¥å…·åº“

### 1.2 ç¡¬ç¼–ç åŸºå‡†æ•°æ®ï¼ˆ9-24è¡Œï¼‰
```python
BENCHMARK_RETURNS_HARDCODED = np.array([...])
```
**ä½œç”¨**ï¼šå­˜å‚¨71ä¸ªäº¤æ˜“æ—¥çš„é»„é‡‘æœŸè´§åŸºå‡†æ”¶ç›Šç‡ï¼ˆå°æ•°å½¢å¼ï¼‰
- ä¾‹å¦‚ï¼š`0.00079190` è¡¨ç¤º 0.07919%
- ç”¨äºè®¡ç®—Alphaã€Betaç­‰ç›¸å¯¹æŒ‡æ ‡

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šæ•°æ®åŠ è½½å’Œé¢„å¤„ç†ï¼ˆ33-102è¡Œï¼‰

### 2.1 åŠ è½½CSVæ–‡ä»¶ï¼ˆ34-42è¡Œï¼‰
```python
@st.cache_data  # Streamlitç¼“å­˜ï¼Œé¿å…é‡å¤è¯»å–
def load_trade_data(filename='jiaoyi.csv'):
```
**ä½œç”¨**ï¼šè¯»å–äº¤æ˜“è®°å½•CSVæ–‡ä»¶
- ä½¿ç”¨GBKç¼–ç ï¼ˆä¸­æ–‡ï¼‰
- è¿”å›DataFrame

### 2.2 æ•°æ®é¢„å¤„ç†ï¼ˆ45-102è¡Œï¼‰
```python
def preprocess_data(df):
```

**è¿™ä¸ªå‡½æ•°åšäº†7ä»¶äº‹**ï¼š

1. **åˆå¹¶æ—¥æœŸæ—¶é—´**ï¼ˆ49-56è¡Œï¼‰
   - å°†"æ—¥æœŸ"å’Œ"å§”æ‰˜æ—¶é—´"åˆå¹¶æˆ"æ—¥æœŸæ—¶é—´"
   - ç”¨äºæ’åºå’Œç»˜å›¾

2. **å¤„ç†æˆäº¤æ•°é‡**ï¼ˆ59-65è¡Œï¼‰
   - å»æ‰"æ‰‹"å­—ï¼Œå»æ‰é€—å·
   - è½¬æ¢ä¸ºæ•°å­—

3. **å¤„ç†æˆäº¤ä»·æ ¼**ï¼ˆ67-75è¡Œï¼‰
   - ç»Ÿä¸€åˆ—åï¼ˆå¯èƒ½æ˜¯"æˆäº¤ä»·"æˆ–"æˆäº¤ä»·æ ¼"ï¼‰
   - å»æ‰é€—å·ï¼Œè½¬ä¸ºæ•°å­—

4. **å¤„ç†æˆäº¤é‡‘é¢**ï¼ˆ77-85è¡Œï¼‰
   - ç»Ÿä¸€åˆ—åï¼ˆå¯èƒ½æ˜¯"æˆäº¤é¢"æˆ–"æˆäº¤é‡‘é¢"ï¼‰
   - è½¬ä¸ºæ•°å­—

5. **å¤„ç†å¹³ä»“ç›ˆäº**ï¼ˆ87-91è¡Œï¼‰
   - å°†"-"æ›¿æ¢ä¸º0
   - è½¬ä¸ºæ•°å­—

6. **å¤„ç†æ‰‹ç»­è´¹**ï¼ˆ93-97è¡Œï¼‰
   - å°†"-"æ›¿æ¢ä¸º0
   - è½¬ä¸ºæ•°å­—

7. **è®¡ç®—å‡€ç›ˆäº**ï¼ˆ99-100è¡Œï¼‰
   ```python
   df['å‡€ç›ˆäº'] = df['å¹³ä»“ç›ˆäº'] - df['æ‰‹ç»­è´¹']
   ```
   **æ ¸å¿ƒå…¬å¼**ï¼šå‡€ç›ˆäº = å¹³ä»“ç›ˆäº - æ‰‹ç»­è´¹

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šé£é™©æŒ‡æ ‡è®¡ç®—ï¼ˆ104-401è¡Œï¼‰â­ æ ¸å¿ƒ

### 3.1 å‡½æ•°ç­¾åï¼ˆ105è¡Œï¼‰
```python
def calculate_risk_metrics(daily_returns, total_returns, initial_capital, daily_pnl, benchmark_returns=None):
```

**è¾“å…¥å‚æ•°**ï¼š
- `daily_returns`: æ—¥æ”¶ç›Šç‡æ•°ç»„ï¼ˆå°æ•°å½¢å¼ï¼Œå¦‚0.01è¡¨ç¤º1%ï¼‰
- `total_returns`: æ€»æ”¶ç›Šç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
- `initial_capital`: åˆå§‹èµ„é‡‘
- `daily_pnl`: æ—¥ç›ˆäºDataFrame
- `benchmark_returns`: åŸºå‡†æ”¶ç›Šç‡ï¼ˆå¯é€‰ï¼‰

**è¾“å‡º**ï¼šè¿”å›ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«æ‰€æœ‰é£é™©æŒ‡æ ‡

### 3.2 åŸºç¡€æ”¶ç›ŠæŒ‡æ ‡ï¼ˆ119-133è¡Œï¼‰

#### Total Returnsï¼ˆç­–ç•¥æ”¶ç›Šï¼‰
```python
metrics['Total Returns'] = total_returns
```
**å«ä¹‰**ï¼šæ•´ä¸ªå›æµ‹æœŸé—´çš„æ€»æ”¶ç›Šç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰

#### Total Annualized Returnsï¼ˆå¹´åŒ–æ”¶ç›Šï¼‰
```python
years = date_range / 365.25
metrics['Total Annualized Returns'] = ((1 + total_returns / 100) ** (1 / years) - 1) * 100
```
**å…¬å¼**ï¼šå¹´åŒ–æ”¶ç›Š = (1 + æ€»æ”¶ç›Š)^(1/å¹´æ•°) - 1
**ä½œç”¨**ï¼šå°†ä¸åŒæ—¶é—´é•¿åº¦çš„ç­–ç•¥æ”¶ç›Šç»Ÿä¸€åˆ°å¹´åŒ–æ ‡å‡†ï¼Œä¾¿äºæ¯”è¾ƒ

### 3.3 æ³¢åŠ¨ç‡æŒ‡æ ‡ï¼ˆ135-145è¡Œï¼‰

#### Algorithm Volatilityï¼ˆç­–ç•¥æ³¢åŠ¨ç‡ï¼‰
```python
metrics['Algorithm Volatility'] = np.std(daily_returns) * np.sqrt(252) * 100
```
**å…¬å¼**ï¼šæ³¢åŠ¨ç‡ = æ—¥æ”¶ç›Šç‡æ ‡å‡†å·® Ã— âˆš252 Ã— 100
- âˆš252ï¼šä¸€å¹´çº¦252ä¸ªäº¤æ˜“æ—¥
- **å«ä¹‰**ï¼šç­–ç•¥æ”¶ç›Šçš„æ³¢åŠ¨ç¨‹åº¦ï¼Œè¶Šå¤§é£é™©è¶Šé«˜

#### Benchmark Volatilityï¼ˆåŸºå‡†æ³¢åŠ¨ç‡ï¼‰
```python
metrics['Benchmark Volatility'] = np.std(benchmark_returns) * np.sqrt(252) * 100
```
**å«ä¹‰**ï¼šåŸºå‡†ï¼ˆé»„é‡‘æœŸè´§ï¼‰çš„æ³¢åŠ¨ç‡

### 3.4 é£é™©è°ƒæ•´æ”¶ç›ŠæŒ‡æ ‡ï¼ˆ147-164è¡Œï¼‰

#### Sharpe Ratioï¼ˆå¤æ™®æ¯”ç‡ï¼‰
```python
metrics['Sharpe'] = metrics['Total Annualized Returns'] / metrics['Algorithm Volatility']
```
**å…¬å¼**ï¼šå¤æ™®æ¯”ç‡ = å¹´åŒ–æ”¶ç›Š / å¹´åŒ–æ³¢åŠ¨ç‡
**å«ä¹‰**ï¼šæ¯æ‰¿æ‹…1å•ä½é£é™©ï¼Œèƒ½è·å¾—å¤šå°‘æ”¶ç›Š
- > 1ï¼šè¡¨ç°è‰¯å¥½
- > 2ï¼šè¡¨ç°ä¼˜ç§€

#### Sortino Ratioï¼ˆç´¢æè¯ºæ¯”ç‡ï¼‰
```python
downside_returns = daily_returns[daily_returns < 0]  # åªå–äºæŸçš„
downside_std = np.std(downside_returns) * np.sqrt(252) * 100
metrics['Sortino'] = metrics['Total Annualized Returns'] / downside_std
```
**å…¬å¼**ï¼šç´¢æè¯ºæ¯”ç‡ = å¹´åŒ–æ”¶ç›Š / ä¸‹è¡Œæ³¢åŠ¨ç‡
**å«ä¹‰**ï¼šç±»ä¼¼å¤æ™®æ¯”ç‡ï¼Œä½†åªè€ƒè™‘äºæŸçš„æ³¢åŠ¨ï¼ˆæ›´å…³æ³¨ä¸‹è¡Œé£é™©ï¼‰

### 3.5 æœ€å¤§å›æ’¤ï¼ˆ166-172è¡Œï¼‰

```python
cumulative_returns = np.cumprod(1 + daily_returns) - 1  # å¤åˆ©ç´¯è®¡æ”¶ç›Š
running_max = np.maximum.accumulate(cumulative_returns)  # å†å²æœ€é«˜ç‚¹
drawdown = cumulative_returns - running_max  # å›æ’¤ = å½“å‰å€¼ - å†å²æœ€é«˜
metrics['Max Drawdown'] = np.min(drawdown) * 100
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **ç´¯è®¡æ”¶ç›Š**ï¼šä½¿ç”¨å¤åˆ©è®¡ç®— `(1+r1)Ã—(1+r2)Ã—...-1`
- **å›æ’¤**ï¼šä»å†å²æœ€é«˜ç‚¹è·Œè½çš„å¹…åº¦
- **æœ€å¤§å›æ’¤**ï¼šæœ€å¤§çš„å›æ’¤å€¼ï¼ˆè´Ÿæ•°ï¼‰

**ä¾‹å­**ï¼š
- ç¬¬1å¤©ï¼šæ”¶ç›Š10% â†’ ç´¯è®¡110%
- ç¬¬2å¤©ï¼šæ”¶ç›Š-5% â†’ ç´¯è®¡104.5%
- ç¬¬3å¤©ï¼šæ”¶ç›Š-10% â†’ ç´¯è®¡94.05%
- æœ€å¤§å›æ’¤ = 94.05% - 110% = -15.95%

### 3.6 Alphaå’ŒBetaï¼ˆ174-233è¡Œï¼‰

#### Betaï¼ˆè´å¡”ï¼‰
```python
covariance = np.cov(daily_returns_clean, benchmark_returns_clean)[0, 1]
benchmark_variance = np.var(benchmark_returns_clean, ddof=0)
metrics['Beta'] = covariance / benchmark_variance
```
**å…¬å¼**ï¼šBeta = Cov(ç­–ç•¥æ”¶ç›Š, åŸºå‡†æ”¶ç›Š) / Var(åŸºå‡†æ”¶ç›Š)
**å«ä¹‰**ï¼š
- Beta = 1ï¼šç­–ç•¥æ³¢åŠ¨ä¸åŸºå‡†ä¸€è‡´
- Beta > 1ï¼šç­–ç•¥æ³¢åŠ¨å¤§äºåŸºå‡†ï¼ˆæ›´æ¿€è¿›ï¼‰
- Beta < 1ï¼šç­–ç•¥æ³¢åŠ¨å°äºåŸºå‡†ï¼ˆæ›´ä¿å®ˆï¼‰
- Beta < 0ï¼šç­–ç•¥ä¸åŸºå‡†è´Ÿç›¸å…³ï¼ˆå¯¹å†²ç­–ç•¥ï¼‰

#### Alphaï¼ˆé˜¿å°”æ³•ï¼‰
```python
strategy_mean_daily = np.mean(daily_returns_clean)
benchmark_mean_daily = np.mean(benchmark_returns_clean)
alpha_daily = strategy_mean_daily - metrics['Beta'] * benchmark_mean_daily
metrics['Alpha'] = alpha_daily * 252 * 100
```
**å…¬å¼**ï¼šAlpha = (ç­–ç•¥å¹³å‡æ—¥æ”¶ç›Š - Beta Ã— åŸºå‡†å¹³å‡æ—¥æ”¶ç›Š) Ã— 252 Ã— 100
**å«ä¹‰**ï¼šç­–ç•¥è¶…è¶ŠåŸºå‡†çš„è¶…é¢æ”¶ç›Šï¼ˆå¹´åŒ–ï¼‰
- Alpha > 0ï¼šç­–ç•¥è·‘èµ¢åŸºå‡†
- Alpha < 0ï¼šç­–ç•¥è·‘è¾“åŸºå‡†

#### Information Ratioï¼ˆä¿¡æ¯æ¯”ç‡ï¼‰
```python
excess_returns = daily_returns_clean - benchmark_returns_clean
tracking_error = np.std(excess_returns) * np.sqrt(252) * 100
excess_return_annual = np.mean(excess_returns) * 252 * 100
metrics['Information Ratio'] = excess_return_annual / tracking_error
```
**å…¬å¼**ï¼šIR = å¹´åŒ–è¶…é¢æ”¶ç›Š / å¹´åŒ–è·Ÿè¸ªè¯¯å·®
**å«ä¹‰**ï¼šè¡¡é‡ä¸»åŠ¨ç®¡ç†èƒ½åŠ›ï¼Œå€¼è¶Šå¤§è¶Šå¥½

### 3.7 èƒœç‡å’Œç›ˆäºæ¯”ï¼ˆ235-275è¡Œï¼‰

#### èƒœç‡
```python
winning_trades = (daily_returns > 0).sum()  # ç›ˆåˆ©äº¤æ˜“æ•°
metrics['èƒœç‡'] = (winning_trades / total_trades * 100)
```
**å«ä¹‰**ï¼šç›ˆåˆ©äº¤æ˜“å æ€»äº¤æ˜“çš„æ¯”ä¾‹

#### æ—¥èƒœç‡
```python
winning_days = (daily_returns_clean > benchmark_returns_clean).sum()
metrics['æ—¥èƒœç‡'] = (winning_days / total_days * 100)
```
**å«ä¹‰**ï¼šç­–ç•¥æ—¥æ”¶ç›Šè·‘èµ¢åŸºå‡†æ—¥æ”¶ç›Šçš„å¤©æ•°æ¯”ä¾‹

#### ç›ˆäºæ¯”
```python
avg_win = daily_returns[daily_returns > 0].mean()  # å¹³å‡ç›ˆåˆ©
avg_loss = abs(daily_returns[daily_returns < 0].mean())  # å¹³å‡äºæŸ
metrics['ç›ˆäºæ¯”'] = avg_win / avg_loss
```
**å«ä¹‰**ï¼šå¹³å‡ç›ˆåˆ© / å¹³å‡äºæŸ
- > 1ï¼šç›ˆåˆ©å¤§äºäºæŸ
- > 2ï¼šè¡¨ç°ä¼˜ç§€

### 3.8 è¶…é¢æ”¶ç›Šç›¸å…³æŒ‡æ ‡ï¼ˆ277-399è¡Œï¼‰

#### AEIï¼ˆæ—¥å‡è¶…é¢æ”¶ç›Šï¼‰
```python
excess_returns = daily_returns_clean - benchmark_returns_clean
metrics['AEI'] = np.mean(excess_returns) * 100
```
**å«ä¹‰**ï¼šç­–ç•¥å¹³å‡æ¯å¤©æ¯”åŸºå‡†å¤šèµšå¤šå°‘ï¼ˆç™¾åˆ†æ¯”ï¼‰

#### è¶…é¢æ”¶ç›Šï¼ˆé™¤æ³•ç‰ˆï¼‰
```python
strategy_total = np.prod(1 + daily_returns_clean) - 1  # ç­–ç•¥æ€»æ”¶ç›Šï¼ˆå¤åˆ©ï¼‰
benchmark_total = np.prod(1 + benchmark_returns_clean) - 1  # åŸºå‡†æ€»æ”¶ç›Šï¼ˆå¤åˆ©ï¼‰
metrics['è¶…é¢æ”¶ç›Š'] = (strategy_total / benchmark_total - 1) * 100
```
**å…¬å¼**ï¼šè¶…é¢æ”¶ç›Š = (ç­–ç•¥æ€»æ”¶ç›Š / åŸºå‡†æ€»æ”¶ç›Š - 1) Ã— 100

#### å¯¹æ•°è½´ä¸Šçš„è¶…é¢æ”¶ç›Š
```python
log_excess = np.log1p(strategy_total) - np.log1p(benchmark_total)
metrics['å¯¹æ•°è½´ä¸Šçš„è¶…é¢æ”¶ç›Š'] = log_excess * 100
```
**å«ä¹‰**ï¼šåœ¨å¯¹æ•°å°ºåº¦ä¸‹è®¡ç®—çš„è¶…é¢æ”¶ç›Šï¼ˆæ›´ç§‘å­¦ï¼‰

#### è¶…é¢æ”¶ç›Šæœ€å¤§å›æ’¤
```python
excess_returns = daily_returns_clean - benchmark_returns_clean
excess_cumulative = np.cumprod(1 + excess_returns) - 1  # ç´¯è®¡è¶…é¢æ”¶ç›Š
excess_running_max = np.maximum.accumulate(excess_cumulative)
excess_drawdown = excess_cumulative - excess_running_max
metrics['è¶…é¢æ”¶ç›Šæœ€å¤§å›æ’¤'] = np.min(excess_drawdown) * 100
```
**å«ä¹‰**ï¼šè¶…é¢æ”¶ç›Šçš„æœ€å¤§å›æ’¤

#### è¶…é¢æ”¶ç›Šå¤æ™®æ¯”ç‡
```python
excess_vol = np.std(excess_returns) * np.sqrt(252) * 100
excess_mean = np.mean(excess_returns) * 252 * 100
metrics['è¶…é¢æ”¶ç›Šå¤æ™®æ¯”ç‡'] = excess_mean / excess_vol
```
**å«ä¹‰**ï¼šè¶…é¢æ”¶ç›Šçš„é£é™©è°ƒæ•´æ”¶ç›Š

---

## ç¬¬å››éƒ¨åˆ†ï¼šå›¾è¡¨ç»˜åˆ¶ï¼ˆ403-636è¡Œï¼‰

### 4.1 äº¤æ˜“ä¿¡å·å›¾ï¼ˆ403-521è¡Œï¼‰
```python
def plot_trading_signals(df):
```

**åŠŸèƒ½**ï¼šç»˜åˆ¶2ä¸ªå­å›¾
1. **ä»·æ ¼èµ°åŠ¿å›¾**ï¼šæ˜¾ç¤ºæˆäº¤ä»·æ ¼æ›²çº¿ï¼Œæ ‡è®°ä¹°å…¥ï¼ˆâ–²ï¼‰å’Œå–å‡ºï¼ˆâ–¼ï¼‰ä¿¡å·
2. **ç´¯è®¡æ”¶ç›Šå›¾**ï¼šæ˜¾ç¤ºæ¯ç¬”äº¤æ˜“çš„ç›ˆäºï¼ˆæŸ±çŠ¶å›¾ï¼‰å’Œç´¯è®¡æ”¶ç›Šï¼ˆæŠ˜çº¿å›¾ï¼‰

**å…³é”®ä»£ç **ï¼š
```python
# ä¹°å…¥ä¿¡å·ï¼ˆç»¿è‰²â–²ï¼‰
buy_signals = df[df['äº¤æ˜“ç±»å‹'].str.contains('å¼€å¤š')]
# å–å‡ºä¿¡å·ï¼ˆçº¢è‰²â–¼ï¼‰
sell_signals = df[df['äº¤æ˜“ç±»å‹'].str.contains('å¹³å¤š')]
```

### 4.2 é£é™©åˆ†æå›¾è¡¨ï¼ˆ523-636è¡Œï¼‰
```python
def plot_risk_charts(df, daily_pnl, metrics, use_log_scale=False):
```

**åŠŸèƒ½**ï¼šç»˜åˆ¶4ä¸ªå­å›¾
1. **ç´¯è®¡æ”¶ç›Šæ›²çº¿**ï¼šç­–ç•¥ç´¯è®¡æ”¶ç›Šéšæ—¶é—´å˜åŒ–
2. **æ—¥ç›ˆäºåˆ†å¸ƒ**ï¼šæ¯å¤©çš„ç›ˆäºï¼ˆæŸ±çŠ¶å›¾ï¼Œç»¿è‰²=ç›ˆåˆ©ï¼Œçº¢è‰²=äºæŸï¼‰
3. **å›æ’¤æ›²çº¿**ï¼šå›æ’¤éšæ—¶é—´å˜åŒ–ï¼ˆå¡«å……çº¢è‰²åŒºåŸŸï¼‰
4. **ç´¯è®¡æ”¶ç›Šç‡æ›²çº¿**ï¼šç´¯è®¡æ”¶ç›Šç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰

---

## ç¬¬äº”éƒ¨åˆ†ï¼šä¸»ç¨‹åºç•Œé¢ï¼ˆ638-785è¡Œï¼‰

### 5.1 ä¸»å‡½æ•°ç»“æ„ï¼ˆ639è¡Œï¼‰
```python
def main():
```

### 5.2 æ•°æ®åŠ è½½å’Œå¤„ç†ï¼ˆ642-690è¡Œï¼‰

**æ­¥éª¤1ï¼šåŠ è½½æ•°æ®**
```python
df = load_trade_data('jiaoyi.csv')
```

**æ­¥éª¤2ï¼šæ•°æ®é¢„å¤„ç†**
```python
df = preprocess_data(df)
```

**æ­¥éª¤3ï¼šè®¡ç®—ç´¯è®¡æ”¶ç›Š**
```python
df['ç´¯è®¡æ”¶ç›Š'] = df['å‡€ç›ˆäº'].cumsum()
```

**æ­¥éª¤4ï¼šè®¡ç®—åˆå§‹èµ„é‡‘**
```python
initial_capital = abs(df['æˆäº¤é‡‘é¢'].iloc[0])
```

**æ­¥éª¤5ï¼šæŒ‰æ—¥æœŸèšåˆ**
```python
daily_pnl = df.groupby('æ—¥æœŸ_ä»…')['å‡€ç›ˆäº'].sum()
```
- å°†å¤šç¬”äº¤æ˜“åˆå¹¶ä¸ºæ¯æ—¥ç›ˆäº

**æ­¥éª¤6ï¼šè®¡ç®—æ—¥æ”¶ç›Šç‡**
```python
daily_pnl['æ—¥æ”¶ç›Šç‡'] = (daily_pnl['æ—¥ç›ˆäº'] / initial_capital) * 100
daily_returns_pct = daily_pnl['æ—¥æ”¶ç›Šç‡'].values / 100  # è½¬ä¸ºå°æ•°
```

**æ­¥éª¤7ï¼šè·å–åŸºå‡†æ•°æ®**
```python
benchmark_returns = BENCHMARK_RETURNS_HARDCODED.copy()
```

**æ­¥éª¤8ï¼šè®¡ç®—é£é™©æŒ‡æ ‡**
```python
metrics = calculate_risk_metrics(daily_returns_pct_aligned, total_returns_pct, initial_capital, daily_pnl_aligned, benchmark_returns)
```

### 5.3 ç•Œé¢æ˜¾ç¤ºï¼ˆ692-781è¡Œï¼‰

**åŸºæœ¬ä¿¡æ¯æ˜¾ç¤º**ï¼ˆ693-701è¡Œï¼‰
- æ€»äº¤æ˜“ç¬”æ•°
- äº¤æ˜“æ—¥æœŸèŒƒå›´
- æ€»ç›ˆäº
- åˆå§‹èµ„é‡‘

**é£é™©æŒ‡æ ‡å±•ç¤º**ï¼ˆ705-737è¡Œï¼‰
- åˆ†ä¸º3åˆ—ï¼šæ”¶ç›ŠæŒ‡æ ‡ã€é£é™©æŒ‡æ ‡ã€äº¤æ˜“ç»Ÿè®¡

**å›¾è¡¨æ˜¾ç¤º**ï¼ˆ741-759è¡Œï¼‰
- äº¤æ˜“ä¿¡å·å›¾
- é£é™©åˆ†æå›¾è¡¨

**æ•°æ®è¡¨æ ¼**ï¼ˆ762-781è¡Œï¼‰
- è¯¦ç»†äº¤æ˜“æ•°æ®ï¼ˆå¯å±•å¼€ï¼‰
- æ—¥åº¦æ±‡æ€»æ•°æ®ï¼ˆå¯å±•å¼€ï¼‰

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µæ€»ç»“

### 1. æ”¶ç›Šç‡è®¡ç®—
- **ç®€å•æ”¶ç›Šç‡**ï¼š`(ä»·æ ¼2 - ä»·æ ¼1) / ä»·æ ¼1`
- **å¤åˆ©ç´¯è®¡**ï¼š`(1+r1) Ã— (1+r2) Ã— ... - 1`

### 2. é£é™©æŒ‡æ ‡åˆ†ç±»
- **æ”¶ç›ŠæŒ‡æ ‡**ï¼šTotal Returns, Alpha, AEI
- **é£é™©æŒ‡æ ‡**ï¼šVolatility, Max Drawdown, Downside Risk
- **é£é™©è°ƒæ•´æ”¶ç›Š**ï¼šSharpe, Sortino, Information Ratio
- **ç›¸å¯¹æŒ‡æ ‡**ï¼šBeta, Alphaï¼ˆéœ€è¦åŸºå‡†æ•°æ®ï¼‰

### 3. æ•°æ®æµç¨‹
```
CSVæ–‡ä»¶ â†’ åŠ è½½ â†’ é¢„å¤„ç† â†’ æŒ‰æ—¥èšåˆ â†’ è®¡ç®—æ”¶ç›Šç‡ â†’ è®¡ç®—æŒ‡æ ‡ â†’ æ˜¾ç¤º
```

---

## ğŸ’¡ ä¸ºä»€ä¹ˆä»£ç æœ‰700å¤šè¡Œï¼Ÿ

1. **é£é™©æŒ‡æ ‡è®¡ç®—**ï¼ˆ~300è¡Œï¼‰ï¼šè®¡ç®—20+ä¸ªæŒ‡æ ‡ï¼Œæ¯ä¸ªæŒ‡æ ‡éƒ½éœ€è¦æ•°æ®å¯¹é½ã€å¼‚å¸¸å€¼å¤„ç†
2. **å›¾è¡¨ç»˜åˆ¶**ï¼ˆ~230è¡Œï¼‰ï¼š2ä¸ªå¤æ‚å›¾è¡¨å‡½æ•°ï¼Œæ¯ä¸ªéƒ½æœ‰å¤šä¸ªå­å›¾
3. **æ•°æ®é¢„å¤„ç†**ï¼ˆ~70è¡Œï¼‰ï¼šå¤„ç†CSVçš„å„ç§æ ¼å¼é—®é¢˜
4. **ç•Œé¢æ˜¾ç¤º**ï¼ˆ~150è¡Œï¼‰ï¼šStreamlitç•Œé¢å¸ƒå±€å’Œæ˜¾ç¤ºé€»è¾‘

**è¿™ä¸ç®—å¤æ‚**ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„é‡‘èåˆ†æç³»ç»Ÿï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½æœ‰å…¶å¿…è¦æ€§ã€‚

---

## ğŸ”§ å¦‚æœæƒ³ç®€åŒ–ä»£ç 

å¯ä»¥æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼š
- `data_loader.py`ï¼šæ•°æ®åŠ è½½å’Œé¢„å¤„ç†
- `metrics_calculator.py`ï¼šé£é™©æŒ‡æ ‡è®¡ç®—
- `plotter.py`ï¼šå›¾è¡¨ç»˜åˆ¶
- `risk.py`ï¼šä¸»ç¨‹åºï¼ˆåªä¿ç•™ç•Œé¢é€»è¾‘ï¼‰

è¿™æ ·æ¯ä¸ªæ–‡ä»¶ä¼šæ›´çŸ­ï¼Œä½†æ€»ä»£ç é‡ä¸å˜ã€‚
