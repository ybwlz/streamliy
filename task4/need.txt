根据交易详情，计算各风险指标，绘制信号图，使用plotly，numpy和pandas均已导入
各风险指标详情：
Total Returns 策略收益
Total Annualized Returns 策略年化收益
Alpha 阿尔法
Beta 贝塔
Sharpe 夏普比率
Sortino 索提诺比率
Information Ratio 信息比率
Algorithm Volatility 策略波动率
Benchmark Volatility 基准波动率
Max Drawdown 最大回撤
Downside Risk 下行波动率
胜率 胜率(%)
日胜率 日胜率(%)
盈亏比 盈亏比
AEI 日均超额收益
超额收益最大回撤 超额收益最大回撤
超额收益夏普比率 超额收益夏普比率
超额收益 除法版超额收益率说明
对数轴 对数轴说明
对数轴上的超额收益 对数轴上的超额收益的计算方法

如果你不明白这些计算方法，可以询问我
具体内容写入risk.py


Rf = 0.04

1、Total Returns     策略收益
Total Returns=(Pend−Pstart)/Pstart∗100%
Pend=策略最终股票和现金的总价值
Pstart=策略开始股票和现金的总价值

2、Total Annualized Returns   策略年化收益
Total Annualized Returns=Rp=((1+P)的250/n次方−1)∗100%
P=策略收益
n=策略执行天数

3、Alpha   阿尔法
投资中面临着系统性风险（即Beta）和非系统性风险（即Alpha），Alpha是投资者获得与市场波动无关的回报。比如投资者获得了15%的回报，
其基准获得了10%的回报，那么Alpha或者价值增值的部分就是5%。


Alpha=α=Rp−[Rf+βp(Rm−Rf)]
Rp=策略年化收益率
Rm=基准年化收益率
Rf=无风险利率（默认0.04）
βp=策略beta值
Alpha值	解释
α>0	策略相对于风险，获得了超额收益
α=0	策略相对于风险，获得了适当收益
α<0	策略相对于风险，获得了较少收益


4、Beta   贝塔
表示投资的系统性风险，反映了策略对大盘变化的敏感性。例如一个策略的Beta为1.5，则大盘涨1%的时候，策略可能涨1.5%，反之亦然；
如果一个策略的Beta为-1.5，说明大盘涨1%的时候，策略可能跌1.5%，反之亦然。

Beta=βp=Cov(Dp,Dm)/Var(Dm)
Dp=策略每日收益
Dm=基准每日收益
Cov(Dp,Dm)=策略每日收益与基准每日收益的协方差
Var(Dm)=基准每日收益的方差
Beta值	解释
β<0	投资组合和基准的走向通常反方向，如空头头寸类
β=0	投资组合和基准的走向没有相关性，如固定收益类
0<β<1	投资组合和基准的走向相同，但是比基准的移动幅度更小
β=1	投资组合和基准的走向相同，并且和基准的移动幅度贴近
β>1	投资组合和基准的走向相同，但是比基准的移动幅度更大


5、Sharpe   夏普比率
表示每承受一单位总风险，会产生多少的超额报酬，可以同时对策略的收益与风险进行综合考虑。

Sharpe Ratio=(Rp−Rf)/σp
Rp=策略年化收益率
Rf=无风险利率（默认0.04）
σp=策略收益波动率


6、Sortino    索提诺比率

表示每承担一单位的下行风险，将会获得多少超额回报。

Sortino Ratio=（Rp−Rf）/σpd
Rp=策略年化收益率
Rf=无风险利率（默认0.04）
σpd=策略下行波动率,就是


7、 Information Ratio   信息比率

衡量单位超额风险带来的超额收益。信息比率越大，说明该策略单位跟踪误差所获得的超额收益越高，
因此，信息比率较大的策略的表现要优于信息比率较低的基准。合理的投资目标应该是在承担适度风险下，尽可能追求高信息比率。

Information Ratio=(Rp−Rm)/σt
Rp=策略年化收益率
Rm=基准年化收益率
σt=策略与基准每日收益差值的年化标准差


8、Algorithm Volatility 策略波动率

用来测量策略的风险性，波动越大代表策略风险越高。

Algorithm Volatility=σp=根号下250/(n−1)*∑(rp−△rp均值)的平方
rp=策略每日收益率
△rp均值=策略每日收益率的平均值=(1/n)∑rp每日
n=策略执行天数

9、Benchmark Volatility    基准波动率
用来测量基准的风险性，波动越大代表基准风险越高。

Benchmark Volatility=σm=根号下250/(n−1)*∑(rm−△rm均值)的平方2
rm=基准每日收益率
△rm均值=基准每日收益率的平均值=(1/n)∑rm每日
n=基准执行天数

10、Max Drawdown    最大回撤

描述策略可能出现的最糟糕的情况，最极端可能的亏损情况。

Max Drawdown=Max((Px−Py)/Px)
Px,Py=策略某日股票和现金的总价值，y>x

11、Downside Risk   下行波动率

策略收益下行波动率。和普通收益波动率相比，下行标准差区分了好的和坏的波动。

Downside Risk=σpd=根号下(250/n)∑(rp−△rpi均值)2f(t)
rp=策略每日收益率
△rpi均值=策略至第i日平均收益率=(1/i)∑(j从1到i)rj
n=策略执行天数
f(t)=1 if rp<△rpi
f(t)=0 if rp>=△rpi #相当于只看差的，但这里不是看收益是负的， 而是小于到第i日平均的收益

12、胜率    胜率(%)
盈利次数在总交易次数中的占比(每次卖出记为一次交易)。

胜率=盈利交易次数/总交易次数  #赚了多少次

13、日胜率    日胜率(%)
策略盈利超过基准盈利的天数在总交易数中的占比。

日胜率=当日策略收益跑赢当日基准收益的天数/总交易日数

14、盈亏比 盈亏比
周期盈利亏损的比例(每次卖出记为一次交易)。

盈亏比=总盈利额/总亏损额

15、AEI   日均超额收益
衡量策略产生的超额收益的总体情况。

AEI=∑(i从1到n)(△EIi−△EI(i−1))/n #就是计算超额收益的当日减前一日的n次均值
其中EI为超额收益。
EI=(策略收益+100%/基准收益+100%)−100%

16、超额收益最大回撤 超额收益最大回撤
描述策略可能出现的跑输基准的最糟糕情况。

EI Max Drawdown=Max(EIx−EIy)/EIx
其中EI为超额收益。
EI=(策略收益+100%)/(基准收益+100%)−100%

17、超额收益夏普比率    超额收益夏普比率
表示每承受一单位总风险，策略相对于基准会产生多少的超额报酬，可以同时对策略的收益与风险进行综合考虑。

EI Sharpe Ratio=(RpEI−Rf)/σpEI
RpEI=年化超额收益率
Rf=无风险利率（默认0.04）
σpEI=超额收益波动率


在对数轴的图上，策略（或者基准）在时间T时显示的高度是：


log(在时间T的净值)
就像我们之前从减法改成用除法一样，对数log可以把乘法变加法，把除法变减法，


log(x∗y)=log(x)+log(y)

log(x/y)=log(x)−log(y)
这样，在对数轴的图上，涨跌幅的倍数就不再是乘除关系而是加法关系，这样回测图上就能看出更丰富的信息了。

举例来说，策略在时间T的时候净值是 S，在 T+1 时是 2S，在 T+2 时是 4S，也就是说在每个时间段都翻了一倍。那么在普通轴上我们可以看出 T+1 的净值比 T 的净值高很多，但是 T+2 的净值比 T+1 高出更多，然而哪个是阶段的涨幅更大却很难看出。如果改用对数轴，那么在 T 时对数轴上高度是 log(S)
；在 T+1 时是 log(2S)=log(2)+log(S)
；在 T+2 时是 log(4S)=2log(2)+log(S)
。这三个数构成一个等差数列，也就是说在对数轴上它们相互之间的距离是一样的，很容易通过目测看出每个时间段的涨跌幅是一样的。

再举个最大回撤的例子。假设一策略在 08 年高峰时的净值是 S，并且在随后的股灾中回撤 80%，即损失 0.8S；它在 15 年高峰时净值有之前的五十倍，50S，并在股灾中回撤 50%，即 25S。在普通轴上我们根本不可能目测出哪个回撤更大，但如果换到对数轴上，在08年高峰和低点的对数值分别是 log(S)
 和 log(S/5)=log(S)−log(5)
，那么对数轴上的回撤是 log(5)
；在15年高峰和低点的对数值分别是 log(50S)
 和 log(25S)=log(50S/2)=log(50S)−log(2)
，在对数轴上的回撤是 log(2)
。由于 log(5)>log(2)
，我们可以很明显地看出 08 年的回撤大于 16 年。

除此之外，策略和基准在同一时间段中的对比也更简单了。假设基准在一段时间里翻了一倍，策略只涨了 50%，那么如果策略净值太大的话我们在普通轴上根本看不出基准有什么变动。在上边我们提到可以根据除法版超额收益的回撤来观测，而另一个方法就是在对数轴上看：在这段时间里基准在对数轴上上升了log(2)
 个单位，而基准只上升了 log(1.5)
 个单位，很直观，上升多的那个就是赢了。

19、
对数轴上的超额收益的计算方法为：

log(策略净值/基准净值)=log(策略净值)−log(基准净值)